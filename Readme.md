# Acompanhamento das Startups## 1. View_kpis DDL**Tem como função principal realizar um self join com a tabela de Indicadores****visando criar uma tupla juntando os dois kpis de determinado tipo;**CREATE     ALGORITHM = UNDEFINED     DEFINER = `bd_cgpe`@`%`     SQL SECURITY DEFINERVIEW `view_kpis` AS/* **Query para retornar as linhas com KPIs diferentes entre si;** */    (SELECT        A.id AS dummy,       A.id AS id,       A.startup AS startup,       C.nome_projeto AS projeto,       A.competencia AS competencia,       A.tipo_kpi AS tipo_kpi,       A.kpi AS kpi1,       A.previsto AS previsto1,       A.realizado AS realizado1,       A.calculado AS calculado1,       A.farol AS farol1,       B.kpi AS kpi2,       B.previsto AS previsto2,       B.realizado AS realizado2,       B.calculado AS calculado2,       B.farol AS farol2,       C.status AS status_projeto    FROM        ((indicadores A        JOIN indicadores B)        JOIN projetos C)    WHERE        ((A.kpi < B.kpi)            AND (A.id = B.id)            AND (A.competencia = B.competencia)            AND (A.tipo_kpi = B.tipo_kpi)            AND (A.id = C.id)            AND (UPPER(C.status) IN ('B - EM DESENVOLVIMENTO' , 'C - EM OPERAÇÃO'))            AND (A.in_carga = 9)            AND (B.in_carga = 9)            AND (C.in_carga = 9))) UNION ALL/* **Query para retornar as linhas com KPIs 'Não Informado' e valores zerados;** */	(SELECT         COUNT(0) AS dammy,        A.id AS id,        A.startup AS startup,        C.nome_projeto AS projeto,        A.competencia AS competencia,        A.tipo_kpi AS tipo_kpi,        A.kpi AS kpi1,        A.previsto AS previsto1,        A.realizado AS realizado1,        A.calculado AS calculado1,        A.farol AS farol1,        B.kpi AS kpi2,        B.previsto AS previsto2,        B.realizado AS realizado2,        B.calculado AS calculado2,        B.farol AS farol2,        C.status AS status_projeto    FROM        ((indicadores A        JOIN indicadores B)        JOIN projetos C)    WHERE        ((A.kpi = B.kpi)            AND (A.id = B.id)            AND (A.competencia = B.competencia)            AND (A.tipo_kpi = B.tipo_kpi)            AND (A.id = C.id)            AND (UPPER(A.kpi) = CONVERT( UPPER('Não Informado') USING UTF8))            AND (UPPER(C.status) IN ('B - EM DESENVOLVIMENTO' , 'C - EM OPERAÇÃO'))            AND (A.in_carga = 9)            AND (B.in_carga = 9)            AND (C.in_carga = 9))    GROUP BY A.id , A.startup , C.nome_projeto , A.competencia , A.tipo_kpi , A.kpi , A.previsto , A.realizado , A.calculado , A.farol , B.kpi , B.previsto , B.realizado , B.calculado , B.farol , C.status    HAVING (COUNT(0) > 1)) UNION ALL/* **Query para retornar as linhas com KPIs 'Não Informado' e valores de previsto/realizado diferentes;** */	 (SELECT         COUNT(0) AS dammy,        A.id AS id,        A.startup AS startup,        C.nome_projeto AS projeto,        A.competencia AS competencia,        A.tipo_kpi AS tipo_kpi,        A.kpi AS kpi1,        A.previsto AS previsto1,        A.realizado AS realizado1,        A.calculado AS calculado1,        A.farol AS farol1,        B.kpi AS kpi2,        B.previsto AS previsto2,        B.realizado AS realizado2,        B.calculado AS calculado2,        B.farol AS farol2,        C.status AS status_projeto    FROM        ((indicadores A        JOIN indicadores B)        JOIN projetos C)    WHERE        ((A.kpi = B.kpi) AND (A.id = B.id)            AND (A.competencia = B.competencia)            AND (A.tipo_kpi = B.tipo_kpi)            AND (A.id = C.id)            AND (UPPER(A.kpi) = CONVERT( UPPER('Não Informado') USING UTF8))            AND (UPPER(C.status) IN ('B - EM DESENVOLVIMENTO' , 'C - EM OPERAÇÃO'))            AND (A.in_carga = 9)            AND (B.in_carga = 9)            AND (C.in_carga = 9))    GROUP BY A.id , A.startup , C.nome_projeto , A.competencia , A.tipo_kpi , `A`.kpi , A.previsto , A.realizado , A.calculado , A.farol , `B`.kpi , B.previsto , B.realizado , B.calculado , B.farol , C.status    HAVING ((COUNT(0) = 1)        AND (CONCAT(CAST(A.previsto AS CHAR CHARSET UTF8MB4),            CAST(A.realizado AS CHAR CHARSET UTF8MB4)) < CONCAT(CAST(B.previsto AS CHAR CHARSET UTF8MB4),            CAST(B.realizado AS CHAR CHARSET UTF8MB4))))) ORDER BY startup , competencia , tipo_kpi , kpi1## 2. Origens de Dados dos Dashboards### . MySQL_view_kpis### 1. Campo **farol_result****Para tipo de kpi = ***Desempenho*** sempre retorna o farol do kpi de Execução;****caso contrário, retorna o farol do kpi que tem o farol de menor valor;**	IF(upper(tipo_kpi)=upper("Desempenho"),farol2,		if(farol1<farol2,farol1,farol2))Obs.: #### Valor do Farol - Cor* 1	-	Vermelho* 2	-	Amarelo* 3	-	Verde* 4	-	Cinza	### 2. Campo **calculado_result****Para tipo de kpi = ***Desempenho*** sempre retorna o valor calculado do kpi de Execução;****caso contrário, retorna o valor calculado do kpi que tem o farol de menor valor;****se os faróis forem iguais, retorna o valor do kpi que tem menor valor calculado.****(essa regra visa garantir que seja considerado sempre o kpi de menor valor de resultado alcançado)**  	IF(UPPER(tipo_kpi)=UPPER("Desempenho"),calculado2,	    if(farol1<farol2,calculado1,	        if(farol1>farol2,calculado2,           	 if(calculado1<calculado2,calculado1,	                calculado2))))